{% extends 'base.html' %}

{% block contents %}
    <!-- 全体のフォームを囲む -->
    <div class="contract-container">
        
        <!-- 説明文 -->
        <section class="contract-description">
            <h1>仮契約書</h1>
            <p>以下の内容をご確認の上、同意いただける場合は「同意する」をクリックしてください。</p>

            <p>飼育場所には十分なスペースがあり、ペットに必要な生活環境を提供できることを保証します。</p>
            <p>飼育に必要な時間、手間、経済的な責任を負うことができることを理解しています。</p>
            <p>私はペットに適切な食事、運動、医療ケアを提供し、ペットの健康と福祉に配慮する責任を負います。</p>
            <p>この仮契約は、正式な契約に移行するための準備段階であり、契約が成立することを保証するものではありません。</p>
            <p>仮契約に基づき、正式な契約に進む意思を確認した後、最終的な契約を結びます。</p>
            <p>仮契約の期間内にキャンセルすることができ、キャンセルの際には所定の手続きを行うことを理解しています。</p>
            <p>仮契約期間内に本契約をしなかった場合、自動的にキャンセルと扱うことを理解しています。</p>

            {% if pet.disease and pet.disease not in exclusion_list %}
                <p class="highlight">このペットには<strong>{{ pet.disease }}</strong>の病気があります。私は、このペットが過去または現在において<strong>{{ pet.disease }}</strong>の病歴を持っていることを認識し、その健康状態に基づく必要なケアを行う責任を負うことを理解しています。</p>
            {% endif %}
        </section>
        
        <!-- 取得されている値 -->
        <section class="contract-details">
            <form method="POST">
                {% csrf_token %}
                
                <!-- ペットの情報 -->
                <div class="form-group">
                    <label>種類</label>
                    <input type="text" value="{{ pet.type }}" disabled>
                </div>
                <div class="form-group">
                    <label>大きさ</label>
                    <input type="text" value="{{ pet.size }}" disabled>
                </div>
                <div class="form-group">
                    <label>色</label>
                    <input type="text" value="{{ pet.color }}" disabled>
                </div>
                <div class="form-group">
                    <label>年齢</label>
                    <input type="text" value="{{ pet.age }}" disabled>
                </div>
                <div class="form-group">
                    <label>品種</label>
                    <input type="text" value="{{ pet.kinds }}" disabled>
                </div>
                <div class="form-group">
                    <label>病歴</label>
                    <input type="text" value="{% if pet.disease and pet.disease not in exclusion_list %}{{ pet.disease }}{% else %}なし{% endif %}" disabled>
                </div>
                <div class="form-group">
                    <label>性格</label>
                    <input type="text" value="{{ pet.personality }}" disabled>
                </div>
                <div class="form-group">
                    <label>性別</label>
                    <input type="text" value="{{ pet.sex }}" disabled>
                </div>

                <!-- ユーザーの情報 -->
                <div class="form-group">
                    <label>氏名</label>
                    <input type="text" value="{{ user.username }}" disabled>
                </div>
                <div class="form-group">
                    <label>メールアドレス</label>
                    <input type="email" value="{{ user.email }}" disabled>
                </div>
                <div class="form-group">
                    <label>住所</label>
                    <input type="address" value="{{ user.address }}" disabled>
                </div>
                <div class="form-group">
                    <label>電話番号</label>
                    <input type="tel" value="{{ user.phone_number }}" disabled>
                </div>

                <div class="form-group">
                    <label>契約終了日</label>
                    <input type="text" name="end_date" value="{{ form.end_date.value|date:'Y-m-d' }}" disabled>
                </div>

                <!-- 同意確認 -->
                <div class="agree">
                    {% if not user_karikeiyaku %}
                    <label for="agreement">契約内容を確認し、同意しますか？</label>
                        <input type="checkbox" id="agreement" name="agreement" required> 
                        <label for="agreement">同意します</label>
                    {% endif %}
                </div>

                <!-- 仮契約中の場合のボタン -->
                <div class="button-group">
                    {% if user_karikeiyaku %}
                        <button class="btn btn-primary" disabled>契約中</button>
                        <a href="{% url 'karikeiyaku:cancel' pet.id %}" class="btn btn-danger">キャンセル</a>
                            <div class="return-button-wrapper">
                                <a href="#" class="return-button" onclick="history.back()">戻る</a>
                            </div>
                    {% else %}
                        <!-- 契約がまだの場合 -->
                        <button type="submit" class="btn btn-success">契約する</button>
                        
                        <!-- 戻るリンク（文字のみ） -->
                        <div class="return-button-wrapper">
                            <a href="#" class="return-button" onclick="history.back()">戻る</a>
                        </div>
                    {% endif %}
                </div>
        </section>
    </div>
{% endblock %}
